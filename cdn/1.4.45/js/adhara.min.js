let HandlebarsHelpers={addAttr:function(e,t){if(e||t){let r=[];t=t&&"string"==typeof t?JSON.parse(t):{};let a=e&&(e.className||e.class)||"";return a+=t.hasOwnProperty("class")?" "+t.class:"",(e=jQuery.extend({},t,e)).class=a,loop(e,function(e,t){if(e&&void 0!==t){if("style"===e){let e=[];loop(t,function(t,r){e.push(t+":"+r+";")}),t=e.join("")}"string"==typeof t&&(t='"'+t.replace(/"/g,'\\"')+'"'),r.push(e+"="+t)}}),new window.Handlebars.SafeString(r.join(" "))}},selectedClass:function(e,t){return!0===e?t:""},include:function(e,t){return new window.Handlebars.SafeString(HandlebarUtils.execute(e,t))},math:function(e,t,r){let a=parseFloat(String(e)),n=parseFloat(String(r));return{"+":a+n,"-":a-n,"*":a*n,"/":a/n,"%":a%n}[t]},i18n:function(e){let t=Array.prototype.slice.call(arguments);return t=t.splice(1,t.length-2),Adhara.i18n.get(e,t)},get:function(e,t){return getValueFromJSON(e,t)},ifCond:function(e,t,r,a){return evaluateLogic(e,t,r)?a.fn(this):a.inverse(this)},mIf:function(){let e=[!0,"and",!0],t=arguments.length-1,r=arguments[t];for(let r=0;r<t;r++)0===r?e[0]=arguments[r]:r%2==1?e[1]=arguments[r]:(e[2]=arguments[r],e[0]=evaluateLogic(e[0],e[1],e[2]));return e[0]?r.fn(this):r.inverse(this)},eIf:function(e,t,r){return evaluateLogic(e,t,r)},global:function(e){return e.startsWith("Adhara.")?getValueFromJSON(Adhara,e.substring("Adhara.".length)):getValueFromJSON(window,e)},loop:function(e,t){let r="";for(let a=0;a<e.length;a++)r+=t.fn(e[a]);return r},append:function(){let e=Array.prototype.slice.call(arguments);return e.pop(),e.map(e=>"object"==typeof e?JSON.stringify(e):e).join("")},make_json:function(e){return JSON.parse(e)},make_context:function(){let e={};for(let t=0;t<arguments.length-1;t+=2)e[arguments[t]]=arguments[t+1];return e},fn_call:function(e){return call_fn.apply(this,Array.prototype.slice.call(arguments).slice(0,-1))},loopObject:function(e,t){let r="";return loop(e,function(e,a){r+=t.fn({key:e,value:a})}),r},iterate_range:function(e,t,r,a){let n="";for(let i=e;i<=r;i+=t)n+=a.fn(i);return n}};function handleForm(e){if(e.submitting)return;let t;if(e.submitting=!0,!!e.querySelector('input[type="file"]'))t=new FormData(e);else{let r=jQuery(e).serializeArray();t={},jQuery.each(r,function(e,r){t[r.name]=r.value})}let r=e.getAttribute("format-data");r&&(t=call_fn(r,t)),!1!==t&&RestAPI[e.getAttribute("api-method")]({url:e.action.split(window.location.host)[1],data:t,successMessage:e.getAttribute("success-message"),handleError:"false"!==e.getAttribute("handle-error"),success:function(t){"true"===e.getAttribute("form-clear")&&e.reset(),jQuery(e).trigger("success",t)},failure:function(t){jQuery(e).trigger("failure",t)}})}function registerConfigUtils(){Adhara.configUtils={getViewInstance(e){try{return Adhara.getView(e.view)}catch(e){return!1}},getProcessor:e=>e.processor||Processor.fallback,getDataConfig:e=>e.data_config,getBlobClass:e=>e.data_config.blob||e.blob||DataBlob,getByDataConfig(e){let t=[],r=Adhara.app.config;for(let a in r)if(r.hasOwnProperty(a)){let r=Adhara.app.getEntityConfig(a);(e._url!==Adhara.configUtils.getDataConfig(r)._url||e.blob&&e.blob!==Adhara.configUtils.getBlobClass(r))&&JSON.stringify(e)!==JSON.stringify(r.data_config)||t.push(r)}return t}}}function registerAdharaUtils(){registerConfigUtils(),window.Handlebars.registerHelper(HandlebarsHelpers),jQuery(document).on("submit","form.api-form",function(e){e.preventDefault(),handleForm(this)}),jQuery(document).on("success","form.dialog-form",function(){this.close.click()})}function evaluateLogic(e,t,r){return"in"===t?r&&-1!==r.indexOf(e):"not_in"===t?r&&-1===r.indexOf(e):"contains"===t?e&&-1!==e.indexOf(r):"not_contains"===t?e&&-1===e.indexOf(r):"has"===t?e&&e.hasOwnProperty(r):{"||":e||r,"&&":e&&r,"|":e|r,"&":e&r,"==":e==r,"===":e===r,"!=":e!=r,"!==":e!==r,">":e>r,"<":e<r,">=":e>=r,"<=":e<=r,equals:e==r,and:e&&r,or:e||r}[t]}function getValueFromJSON(e,t,r){try{if(!t)return e;let a=t.split(".");for(let n=0;n<a.length;n++){let i=a[n];if(-1!==i.indexOf("[")){let a=i.split("["),s=a[0],o=a[1].split("]")[0];if(isNaN(o)){let a=e[s],i=o.substring(r.length,o.length),l="";for(let e=0;e<a.length;e++)e>0&&(l+=i),l+=getValueFromJSON(a[e],t.split(".").splice(n+1).join("."),r);e=l}else e=e[s][o];break}e=e[i]}return e}catch(e){return}}function setValueToJson(e,t,r){let a=t.split(".");loop(a,function(t,n){t+1<a.length?(e.hasOwnProperty(n)||(e[n]={}),e=e[n]):e[n]=r})}function call_fn(e){if(!e)return;let t=Array.prototype.slice.call(arguments);if(t.splice(0,1),"function"==typeof e)return e.apply(e,t);try{if((e=getValueFromJSON(window,e))&&e!==window)return e.apply(window[e],t)}catch(t){throw"TypeError"===t.name&&-1!==t.message.indexOf("is not a function")?new Error("error executing function : "+e):t}}function call_fn_or_def(e){let t=Array.prototype.slice.call(arguments),r=t.pop();return"function"!=typeof r&&"function"!=typeof window[r]&&(t.push(r),r=void 0),e?call_fn.apply(call_fn,t):r?(t[0]=r,call_fn.apply(call_fn,t)):void 0}function loop(e,t,r){let a,n;if(e instanceof Array)if(n=e.length,r)for(a=n-1;a>=0&&!1!==t(a,e[a]);a--);else for(a=0;a<n&&!1!==t(a,e[a]);a++);else{let r=Object.keys(e);for(n=r.length,a=0;a<n&&!1!==t(r[a],e[r[a]]);a++);}}let HandlebarUtils={};!function(){let e={};HandlebarUtils.execute=function(t,r,a){let n=window.Handlebars.templates[t];return!n&&window.Handlebars.hasOwnProperty("compile")&&(!1!==a?(n=e[t])||(n=e[t]=window.Handlebars.compile(t)):n=window.Handlebars.compile(t)),n(r)}}();class Internationalize{constructor(e){this.key_map=e}getValue(e,t,r){let a=this.key_map[e]||getValueFromJSON(this.key_map,e);if(!a)return r;if(t&&t.length)for(let[e,r]of t.entries()){try{-1!==r.indexOf(".")&&(r=this.get(r))}catch(e){}a=a.replace(new RegExp("\\{"+e+"\\}","g"),r)}return a}get(e,t){return this.getValue(e,t,e)}}function MutateViews(e,...t){class r extends e{constructor(...e){super(...e),t.forEach(t=>{a(this,new t(...e))})}}function a(e,t){Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t)).forEach(r=>{r.match(/^(?:constructor|prototype|arguments|caller|name|bind|call|apply|toString|length)$/)||Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return t.forEach(e=>{a(r.prototype,e.prototype),a(r,e)}),r}class AdharaApp{get is_debug_mode(){return-1!==["localhost","127.0.0.1","0.0.0.0"].indexOf(window.location.hostname)||-1!==window.location.hostname.indexOf("192.168.")}get name(){return"Adhara App"}get detailedName(){return{first:"Adhara",last:"App"}}get tagLine(){}get containerView(){}get config(){return{}}getEntityConfigFromContext(e){let t,r=e.data_config.allowed_query_types?e.data_config.allowed_query_types.slice():[];return e.data_config.hasOwnProperty("batch_data_override")?t={batch_data_override:e.data_config.batch_data_override.map(e=>(e.reuse||(e.reuse={}),{_url:e.url,url:e.url,query_type:e.query_type,identifier:e.identifier,reuse:{enable:e.reuse.enable,timeout:e.reuse.timeout,scope:e.reuse.scope,handler:e.reuse.handler},blob:e.blob}))}:(e.data_config.reuse||(e.data_config.reuse={}),t={_url:e.data_config.url,url:e.data_config.url,allowed_query_types:r,default_query_type:e.data_config.default_query_type||r[0],socket_tag:e.data_config.socket_tag,reuse:{enable:e.data_config.reuse.enable,timeout:e.data_config.reuse.timeout,scope:e.data_config.reuse.scope,handler:e.data_config.reuse.handler},blob:e.data_config.blob}),{data_config:t,view:e.view,processor:e.processor}}getEntityConfig(e){return this.getEntityConfigFromContext(this.config[e])}get customViewConfig(){return{fetching_data:{AdharaListView:"Fetching Data..."},no_data:{AdharaListView:"No Data Available"}}}get allowedHttpMethods(){return["get","post","put","delete"]}get routerConfiguration(){return{routes:[],on_route_listeners:{},middlewares:[]}}get DOMSelector(){return"app"}get apiServerURL(){return"/api"}get webSocketConfig(){}get DBConfig(){return[{id:"default",name:"Adhara-app_db",version:1,schema:{http_cache:{keyPath:"url"}}}]}get _diConfig(){return Object.assign({http_cache_table:"http_cache",default_reuse:!0,reuse_timeout:3e5},this.DIConfig)}get DIConfig(){return{}}get scopes(){return{global:window}}responseMiddleWare(e,t,r,a){return r}requestMiddleWare(e,t,r){return r}toast(e,t,r){AdharaDefaultToaster.make(e,t,r)}get i18n_key_map(){return{"i18n.adhara.list.previous":"Previous","i18n.adhara.list.next":"Next"}}}let Adhara=null;(()=>{let e={};(Adhara=new class{init(e){!function(){for(let e of t)e()}(),this.always_active_views=[],this.active_views=[],this.container=null,this.router=AdharaRouter,this.toast=Toast,e?(this.app=new e,this.dataInterface=new DataInterface,this.restAPI=RestAPI,this.i18n=new Internationalize(Adhara.app.i18n_key_map),this.createShortcuts(),this.performSystemChecks(),this.createContainer(),this.app.webSocketConfig&&WebSocket.listen(this.app.webSocketConfig)):this.router.route()}createShortcuts(){this.view_context={},loop(this.app.config,(e,t)=>{t.hasOwnProperty("view")&&AdharaView.isPrototypeOf(t.view)&&(this.view_context[t.view.name]=e)})}performSystemChecks(){}createContainer(){this.router.configure(this.app.routerConfiguration),this.router.listen(),this.app.containerView?(this.container=new this.app.containerView,this.container.onViewRendered(this.router.route),this.always_active_views=this.container.subViews.map(e=>Adhara.getView(e)),this.always_active_views.push(this.container),this.clearActiveViews(),Adhara.createView(this.container)):(this.clearActiveViews(),this.router.route())}get viewHierarchy(){return[AdharaContainerView,AdharaDialogView,AdharaTemplateView,AdharaCardView,AdharaGridView,AdharaListView,AdharaFormView,AdharaView]}addToActiveViews(e){this.isActiveView(e)||this.active_views.push(e)}getActiveView(e){let t=this.active_views.filter(t=>t.constructor===e)[0];return t||(t=this.always_active_views.filter(t=>t.constructor===e)[0]),t}isActiveView(e){return-1!==this.active_views.indexOf(e)||-1!==this.always_active_views.indexOf(e)}clearActiveViews(){this.active_views=[]}closeActiveViews(){for(let e of this.active_views)e.destroy();this.clearActiveViews()}}).addViewToInstances=(t=>{e[t.constructor.name]=t}),Adhara.getView=((e,t)=>{if(!e)throw new Error("invalid view class");let r=Adhara.getActiveView(e instanceof Function?e:e.constructor);if(r)return r;if(t)return new e(t);throw new Error(`parent view is required to construct a view. Failed to create view: ${e.constructor.name}`)}),Adhara.createView=((e,t)=>{e.create(t)}),Adhara.onRoute=(e=>{if(Adhara.closeActiveViews(),!Adhara.container.isActive())return Adhara.container.create();Adhara.createView(Adhara.getView(e,Adhara.container))});let t=[registerAdharaUtils];Adhara.onInit=(e=>{t.push(e)}),Adhara.lightReload=(()=>{Adhara.container?Adhara.container.refresh():Adhara.router.route()})})();let AdharaRouter=null;(()=>{"use strict";let e,t={},r={},a={},n=[],i=void 0,s=void 0,o={},l=[];function u(){return window.location.href}function c(){return AdharaRouter.transformURL(window.location.pathname)}function d(){return window.location.pathname+window.location.search+window.location.hash}function h(){return window.location.search.substring(1)}function p(e){function t(e){return 0===e.indexOf("/")?e.substring(1):e}return t(d())===t(e)}function f(){let e=c(),r=!1;for(let a in t)if(t.hasOwnProperty(a)&&!r){let n=new RegExp(a);if(n.test(e)){return r=!0,{opts:t[a],path:e,params:n.exec(e)}}}}function g(){let e=f();if(e){let{opts:t,path:n,params:o}=e;if(o.splice(0,1),t&&t.fn){let e={};for(let[r,a]of o.entries())e[t.path_param_keys[r]]=a;s=t,a=e,i=u(),w(),function(e,t){let r=0;!function a(){let n=l[r++];n?call_fn(n,e,a):t()}()}({view_name:t.view_name,path:n,query_params:b(),path_params:e},()=>{o.push(r),t.fn.constructor instanceof AdharaView.constructor?Adhara.onRoute(t.fn,o):t.fn.apply(this,o)})}}return!!e}function m(){e&&n.push(e),e=d()}m();let _=!1;function b(){let e={};return h()?loop(h().split("&"),function(t,r){r=r.split("="),e[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}):e={},e}function w(){r=b()}function y(){let e=c(),t=[];return loop(r,function(e,r){t.push(e+"="+r)}),t.length&&(e+="?"+t.join("&")),e}function v(e,t){e&&e!==this.RouteTypes.SET?e===this.RouteTypes.NAVIGATE?this.navigateTo(y(),t&&t.force||!1):e===this.RouteTypes.OVERRIDE?this.overrideURL(y()):e===this.RouteTypes.UPDATE&&this.updateURL(y()):this.setURL(y())}const A="__adhara_router__";class C{static transformURL(e){return e}static register_one(e,r,a){let n=[],i=/{{([a-zA-Z$_][a-zA-Z0-9$_]*)}}/g,s=i.exec(e);for(;null!=s;)n.push(s[1]),s=i.exec(e);e=e.replace(new RegExp("\\{\\{[a-zA-Z$_][a-zA-Z0-9$_]*\\}\\}","g"),""),e=(e="^"+this.transformURL(e.substring(1))).replace(/[?]/g,"\\?"),t[e]={view_name:r,fn:a,path_param_keys:n}}static deRegister(e){t[e]=void 0}static register(e){for(let t of e)this.register_one(t.url,t.view_name,t.view)}static configure(e){if(e.routes&&C.register(e.routes),e.on_route_listeners)for(let t in e.on_route_listeners)e.on_route_listeners.hasOwnProperty(t)&&C.onRoute(t,e.on_route_listeners[t]);if(e.middlewares)for(let t of e.middlewares)C.registerMiddleware(t)}static onRoute(e,t){o[e]=t}static offRouteListener(e){o[e]=void 0}static registerMiddleware(e){"function"==typeof e&&l.push(e)}static route(){if(_)_=!1;else{if(!g())throw new Error("No route registered for this url : "+c())}loop(o,function(e,t){call_fn(t)})}static getCurrentRoute(){return s||(s=f().opts),s}static getCurrentPageName(){return AdharaRouter.getCurrentRoute().view_name}static getCurrentURL(){return d()}static getCurrentHash(){return window.location.hash.substring(1)}static go(e){if(p(e))return!1;history.pushState({[A]:!0},parent.document.title,e);let t=history.state;return m(),a={},void 0!==t&&""!==t&&(!0!==t[A]&&!0!==t.data[A]||this.route()),!0}static setURL(e){e=this.transformURL(e),_=!0,this.go(e)||(_=!1)}static overrideURL(e){e=this.transformURL(e),history.replaceState({[A]:!0},parent.document.title,e)}static updateURL(e){_=!0,this.overrideURL(e)}static navigateTo(e,t){if(p(e=this.transformURL(e)))t&&this.route();else{this.go(e)&&w()}}static goBack(e){if(!e&&!(e=n.slice(-1)[0]))return!1;e=this.transformURL(e);let t=n.lastIndexOf(e);if(-1===t)this.navigateTo(e);else{let e=n.length,r=t-e;n.splice(e+r,-r),history.go(r)}}static peekStack(){return n.slice()}static getQueryParam(e){return u()!==i&&(i=u(),w()),r[e]}static getPathParam(e){return a[e]}static updateQueryParams(e,t,a,n){a||(a=this.RouteTypes.NAVIGATE),Object.keys(e).length&&(t?r=e:Object.assign(r,e),v(a,n))}static removeQueryParams(e,t,a){loop(e,function(e,t){delete r[t]}),v(t,a)}static getURLPatternByPageName(e){let r=null;return loop(t,function(t,a){if(a.view_name===e)return r=t,!1}),r}}AdharaRouter=C,window.onpopstate=(e=>{AdharaRouter.route()}),AdharaRouter.RouteTypes=Object.freeze({NAVIGATE:"navigate",OVERRIDE:"override",SET:"set",UPDATE:"update"}),AdharaRouter.enableAllAnchors=!0,AdharaRouter.listen=function(){function e(e,t){return e.hasAttribute(t)}function t(t){let r=function(e){return"A"!==e.target.nodeName?e.currentTarget:e.target}(t);if((AdharaRouter.enableAllAnchors||e(r,"route"))&&e(r,"href")){let e=this.getAttribute("href").trim(),r=this.getAttribute("target");if(r&&"_self"!==r||-1!==e.indexOf("javascript"))return;try{if(new URL(e).host!==window.location.host)return}catch(e){}e&&(t.preventDefault(),t.stopPropagation());let a=this.getAttribute("data-back"),n="false"!==this.getAttribute("data-force");if(a)return AdharaRouter.goBack(e);AdharaRouter.navigateTo(e,n)}}jQuery(document).on("click","a",t),jQuery(document).on("click","[route]",t)}})();let Toast={make:function(e,t,r){Adhara.app?Adhara.app.toast(e,t,r):window.ToastHandler?window.ToastHandler[r](t,e):console.log(`No toast handler found. Toast message: type-${r}, title-${e}, content=${t}`)},error:function(e){Toast.make("Error!",e,"error")},success:function(e){Toast.make("Success",e,"success")}},AdharaDefaultToaster={};!function(){let e=0;AdharaDefaultToaster.make=function(t,r,a){let n=window.innerHeight-200,i=0;jQuery.each(jQuery(".notification"),function(){i+=jQuery(this).height()+40});let s=i<n;r||"failure"!==a||(r="Error occurred..."),setTimeout(function(){0===e&&s?(e++,function(t,r,a){let n="notification_"+(new Date).getTime(),i=jQuery('<div class="notification '+a+'" id="'+n+'"/>'),s=jQuery('<strong style="display:block" />').text(t),o=jQuery("<p />").html(r);i.append(s).append(o),jQuery("body").append(i);let l=jQuery(".notification");l.length>0&&jQuery.each(l,function(e,t){if(jQuery(this).attr("id")!==n){let e=parseFloat(jQuery(this).css("top"))+i.height()+40;jQuery(this).animate({top:e+"px"},"fast")}}),jQuery("#"+n).animate({right:"0px"},"fast",function(){e--}),setTimeout(function(){jQuery("#"+n).animate({opacity:"0.5"},"fast",function(){jQuery("#"+n).hide("slide",{direction:"right"},"slow",function(){setTimeout(function(){jQuery("#"+n).remove()},1e3)})})},5e3)}(t,r,a)):AdharaDefaultToaster.make(t,r,a)},0===e?0:2e3)}}();let RestAPI={};function deserialize(e,t){if("object"==typeof t&&t.blob){let r=JSON.parse(e);return new t.blob(r)}if(t){let r=JSON.parse(e);return new t.blob(r)}throw new Error(`context passed is invalid: ${t}`)}function isPrimitive(e){return e!==Object(e)}!function(){function e(e){e.url=function(e){let t=Adhara.app?Adhara.app.apiServerURL:"/";return t.lastIndexOf("/")+1!==t.length&&(t+="/"),0===e.indexOf("/")&&(e=e.substring(1)),t+e}(e.url);let t=e.success,r=e.failure;e.success=function(a,n,i){RestAPI.handle_api_success(t,r,a,n,i,e.handleError,e.successMessage)},e.error=function(e,t,a){RestAPI.handle_api_failure(r,e,t,a)},e.headers=RestAPI.getHeaders(),e.data instanceof FormData?function(e){let t=new XMLHttpRequest;t.open(e.type.toUpperCase(),e.url),loop(e.headers,function(e,r){t.setRequestHeader(e,r)}),t.onreadystatechange=function(){t.readyState===XMLHttpRequest.DONE&&(200===t.status?e.success(t.responseText,"success",t):e.error(t,"error","Multipart upload error"))},t.send(e.data)}(e):function(e){"get"!==e.type&&e.data instanceof Object&&(Object.keys(e.data).length?e.data=JSON.stringify(e.data):delete e.data);e.headers["Content-Type"]="application/json",jQuery.ajax(e)}(e)}RestAPI.error_codes={not_found:404},RestAPI.getCookie=function(e){let t=null;if(document.cookie&&""!==document.cookie){let r=document.cookie.split(";");for(let a=0;a<r.length;a++){let n=jQuery.trim(r[a]);if(n.substring(0,e.length+1)===e+"="){t=decodeURIComponent(n.substring(e.length+1));break}}}return t},RestAPI.getHeaders=function(){return{"X-CSRFToken":RestAPI.getCookie("csrftoken")}},RestAPI.handle_api_success=function(e,t,r,a,n,i,s){if("nocontent"!==a){if("success"===a){if(n.getResponseHeader("Content-Disposition"))return call_fn(e,r,n);if("string"==typeof r&&(r=JSON.parse(r)),"success"===r.status)return s&&""!==s&&Toast.success(s),call_fn(e,r,n)}!1!==i&&Toast.error(r,n),call_fn(t,r,n)}},RestAPI.handle_api_failure=function(e,t,r,a){0===t.readyState&&0===t.status&&""===a&&(a="Unable to connect to server"),call_fn(e,a,t)},RestAPI.post=function(t){t.type="post",e(t)},RestAPI.get=function(t){t.type="get",e(t)},RestAPI.put=function(t){t.type="put",e(t)},RestAPI.patch=function(t){t.type="patch",e(t)},RestAPI.delete=function(t){t.type="delete",e(t)}}();class Serializable{static _validateData(e){if(isPrimitive(e))return!0;if("object"!=typeof e||null===e||e instanceof Array)return!0;{let t=function e(t,r){if(isPrimitive(t)&&isPrimitive(r))return t===r;if(isPrimitive(t)!==isPrimitive(r))return!1;for(let a in t)if(t.hasOwnProperty(a)&&!e(t[a],r[a]))return!1;return!0}(JSON.parse(JSON.stringify(e)),e);return t||console.warn("Equivalence check failed for the data. Data is not serializable.",e),t}}constructor(e){if(!Serializable._validateData(e))throw new Error(`blob must be initialized with serializable(tree-like, non-array) object: ${e}`)}serialize(){throw new Error("Need to define method: serialize")}}class DataBlob extends Serializable{constructor(e){if(super(e),!e)return;if(this._data=e,!1===this.validate(e))throw new Error(`assigned data does not clear the custom validation: ${e}`)}static get _context(){return"base"}get data(){return this._data}set data(e){if(!Serializable._validateData(e))throw new Error(`blob must represent a non-array, tree-like object ${e}`);if(!1===this.validate(e))throw new Error(`assigned data does not clear the custom validation: ${e}`);this._data=e}get packet(){return this.serialize()}validate(){return!0}_formatTimeBit(e){return(1===e.toString().length?"0":"")+e.toString()}_formatTime(e){return`${this._formatTimeBit(e.getHours())}:${this._formatTimeBit(e.getMinutes())}:${this._formatTimeBit(e.getSeconds())}`}_formatDate(e){return`${this._formatTimeBit(e.getDate())}/${this._formatTimeBit(e.getMonth())}/${e.getFullYear()}`}}class AdharaController{control(e,t,r,a){return Adhara.dataInterface.enqueue(e,t,r,a)}getData(e,t,r){this.control("get",e,t,r)}getListData(e,t,r){this.control("get_list",e,t,r)}putData(e,t,r){this.control("put",e,t,r)}postData(e,t,r){this.control("post",e,t,r)}deleteData(e,t,r){this.control("delete",e,t,r)}}class AdharaView extends AdharaController{constructor(e){super(),this._parentViewInstance=e,Adhara.addViewToInstances(this),this._data=null,this._state={},this._error=null,this._event_listeners={},this.is_active=!1,this._registerEvents(["ViewRendered","SubViewsRendered","ViewFormatted","ViewDestroyed"]),this._registerEvents(this.events),this.onInit()}onInit(){}get events(){return[]}_registerEvents(e){for(let t of e)this._event_listeners[t]=[],this["on"+t]=(e=>{this._event_listeners[t].push(e)}),this["off"+t]=(e=>{this._event_listeners[t].splice(this._event_listeners[t].indexOf(e),1)})}trigger(e,...t){for(let r of this._event_listeners[e])r(t)}get template(){if(Adhara.router.getCurrentPageName())return Adhara.router.getCurrentPageName().replace(/_/g,"-");{let e=this.constructor.name.toLowerCase();return e.endsWith("view")?e.slice(0,e.length-4):e}}getCustomTemplate(e){for(let t of Adhara.viewHierarchy)if(t.isPrototypeOf(this.constructor)&&Adhara.app.customViewConfig[e]&&Adhara.app.customViewConfig[e][t.name])return Adhara.app.customViewConfig[e][t.name]}get errorTemplate(){return this.getCustomTemplate("error")||null}get fetchingDataTemplate(){return this.getCustomTemplate("fetching_data")||""}get noDataTemplate(){return this.getCustomTemplate("no_data")||""}getTemplate(){return this.state.fetching_data?this.fetchingDataTemplate:this.errors&&this.errorTemplate||this.template}getURLPathParams(e){return null}get payload(){return null}formatURL(e,t){if(!t)return e;let r=e.match(/\${([a-zA-Z0-9$_]*)}/gi),a=r.map(e=>"${this."+/\${([a-zA-Z0-9$_]*)}/.exec(e)[1]+"}");for(let t in r)e=e.replace(r[t],a[t]);return new Function("return `"+e+"`;").call(t)}formatEntityConfig(e){if(e.data_config.hasOwnProperty("batch_data_override"))for(let t of e.data_config.batch_data_override){let e=this.getURLPathParams(t.identifier);e&&(t.url=this.formatURL(t.url,e))}else{let t=this.getURLPathParams();t&&(e.data_config.url=this.formatURL(e.data_config.url,t))}return e}get entityConfig(){let e=Adhara.view_context[this.constructor.name];return e?this.formatEntityConfig(Adhara.app.getEntityConfig(e)):null}getPayload(){return this.payload}get state(){return this._state}create(e){e&&AdharaView.isPrototypeOf(e.constructor)&&(this._parentViewInstance=e),Adhara.addToActiveViews(this),this.is_active=!0,this.fetchData()}isActive(){return Adhara.isActiveView(this)&&this.is_active}fetchData(){this._state.fetching_data=!0;let e=this.entityConfig;if(e)return e.data_config.hasOwnProperty("batch_data_override")?(this.render(),this.control(void 0,e)):"get"===Adhara.dataInterface.getHTTPMethod(e.data_config.default_query_type)?(this.render(),this.control(e.data_config.default_query_type,e,this.getPayload())):this.handleDataChange();this.handleDataChange()}handleDataChange(e){this.isActive()&&(this.dataChange(e),this._state.fetching_data=!1,this.render())}handleDataError(e){this.isActive()&&(this.dataError(e),this._state.fetching_data=!1,this.render())}handleBatchData(e){if(!this.isActive())return;let t={},r={};for(let a in e)e.hasOwnProperty(a)&&(e[a].hasOwnProperty("error")?t[a]=e[a].error:r[a]=e[a].success);Object.keys(r).length&&this.dataChange(r),Object.keys(t).length&&this.dataError(t),this._state.fetching_data=!1,this.render()}dataChange(e){this._data=e,this._error=null}dataError(e){this._error=e}get errors(){return this._error}get data(){return this._data}_getHTML(e){return HandlebarUtils.execute(e||this.getTemplate(),this)}get parentView(){return this._parentViewInstance||Adhara.getView(Adhara.app.containerView)}_getParentContainer(){let e=this.parentView.contentContainer;return"string"==typeof e?e:e[this.constructor.name]||e["*"]}getParentContainerElement(){return document.querySelector(this._getParentContainer())}_render(){}render(){let e=this.getParentContainerElement();e?(e.innerHTML=this._getHTML(),this.state.fetching_data||(this.trigger("ViewRendered"),this._format(e),setTimeout(()=>{this.format(e),this.trigger("ViewFormatted")},0),this.renderSubViews(),this.trigger("SubViewsRendered"))):console.warn("No container defined/available",this.constructor.name)}get contentContainer(){throw new Error("implement this method")}get subViews(){return[]}renderSubViews(){if(this.subViews)for(let e of this.subViews)Adhara.createView(Adhara.getView(e,this),this)}_format(e){for(let t of["click","change"]){let r=e.querySelectorAll(`[data-on${t}]`);for(let e of r)e.dataset._adharaevent_||(e.addEventListener(t,r=>{let a=e.dataset,n=`on${t}`;if(this[a[n]])this[a[n]](r,a,this);else{let e=getValueFromJSON(window,a[n]);if(!e)throw new Error(`Invalid function: ${a[n]} in View ${this.constructor.name}`);e(r,a,this)}}),e.dataset._adharaevent_=!0)}}format(e){}refresh(){Adhara.createView(this)}onDestroy(){}destroy(){this.onDestroy(),this.trigger("ViewDestroyed"),this.is_active=!1;try{this.getParentContainerElement().innerHTML=""}catch(e){}}}class AdharaListView extends AdharaView{constructor(e){super(e),this._page_number=1}get template(){return"adhara-list"}get listTemplate(){throw new Error("override `get listTemplate`")}get headerTemplate(){throw new Error("override `get headerTemplate`")}get itemTemplate(){throw new Error("override `get itemTemplate`")}get title(){return""}get isPaginationRequired(){return!1}get columns(){return[]}get noDataAvailable(){return"No Data Available"}get addNew(){return!1}get rowCount(){return AdharaListView.rowCount}get pageNumber(){return this._page_number}get isFirstPage(){return 1===this._page_number}get isLastPage(){return this.data.length<this.rowCount}onPreviousPage(){this._page_number=this.pageNumber-1,this.pageChange()}onNextPage(){this._page_number=this.pageNumber+1,this.pageChange()}pageChange(){this.fetchData()}getPayload(){return Object.assign({},this.payload,AdharaListView.getPagePayload(this.pageNumber))}}AdharaListView.rowCount=5,AdharaListView.getPagePayload=(e=>({page:e}));class AdharaFormView extends AdharaView{get action(){return this.formElement?this.formElement.action.split(window.location.host)[1]:""}get method(){return this.formElement&&this.formElement.getAttribute("api-method")||"post"}get formEntityConfig(){let e=this.formElement;return Adhara.app.getEntityConfigFromContext({data_config:{url:this.formatURL(this.action,this.getURLPathParams()),allowed_query_types:[this.method],default_query_type:this.method},processor:{success:(t,r,a,n,i)=>{this.clearFormOnSuccess&&e.reset(),this.updateFormState(!1),this.onSuccess(a)},error:(e,t,r,a,n)=>{this.updateFormState(!1),this.onError(r)}}})}get clearFormOnSuccess(){return"true"===this.formElement.getAttribute("form-clear")}onSuccess(e){Toast.success("Success")}onError(e){Toast.error(e)}onValidationError(e){Toast.error(e.message)}validate(e){let t=this.formElement.getAttribute("validate-data");if(t)return!!call_fn(t,e)}formatData(e){let t=this.formElement.getAttribute("format-data");return t&&(e=call_fn(t,e)),e}get formElement(){if(this._formElement&&document.body.contains(this._formElement)||(this._formElement=this.getParentContainerElement().querySelector("form")),!this._formElement)throw new Error("No from element discovered!");return this._formElement}getFieldValue(e){let t=this.formElement[e];return"number"===t.type?+t.value:"checkbox"===t.type?t.checked:t.value}setFieldValue(e,t){let r=this.formElement[e];"checkbox"===r.type?r.checked=!0:r.value=t}get handleFileUploads(){return!0}updateFormState(e){this.formElement.submitting=e,this.handleSubmitButton()}get submitButton(){return this.formElement.querySelector('button[type="submit"]')}handleSubmitButton(){let e=this.submitButton;e?this.formElement.submitting?(e.dataset.tosubmit=e.innerHTML,e.innerHTML=e.dataset.inprogress||e.dataset.tosubmit,e.disabled=!0):(e.dataset.inprogress=e.innerHTML,e.innerHTML=e.dataset.tosubmit,e.disabled=!1):console.warn("Unable to discover 'Submit button'. Duplicate submission are not handled.")}_handleForm(){let e,t=this.formElement;if(t.submitting)return;this.updateFormState(!0);let r=Array.prototype.slice.apply(t.querySelectorAll('input[type="file"]')).filter(e=>!e.disabled);if(this.handleFileUploads&&r.length)e=new FormData(t);else{let r=jQuery(t).serializeArray();e={},jQuery.each(r,function(t,r){e[r.name]=r.value})}try{this.validate(e)}catch(e){return this.onValidationError(e)}return e=this.formatData(e),this.control(this.method,this.formEntityConfig,e)}_format(e){super._format(e),this.errors||this.formElement.addEventListener("submit",e=>{e.preventDefault(),this.submit()})}submit(){this._handleForm(this.formElement)}}class AdharaGridView extends AdharaListView{get listTemplate(){return"adhara-list-grid"}get tableClass(){return"table-bordered table-hover"}}class AdharaTemplateView extends AdharaListView{get listTemplate(){return"adhara-list-template"}get headerTemplate(){return"adhara-list-template-header"}get itemTemplate(){return"adhara-list-template-item"}get tableClass(){return"table-bordered table-hover"}get containerAttributes(){return{}}}class AdharaCardView extends AdharaListView{get template(){return"adhara-card"}get containerClass(){return""}get cardSizeClass(){return"col-md-4"}get itemTemplate(){return"adhara-card-content"}}class AdharaDialogView extends AdharaView{onInit(){this._modalId="adhara-dialog-id-"+Date.now(),this.destroy=this.destroy.bind(this)}get template(){return"adhara-dialog"}get titleTemplate(){return"Adhara Dialog"}get messageTemplate(){return"Adhara Dialog Message!"}get buttons(){return[{attributes:{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},text:"Close"}]}get modalId(){return this._modalId}get wrapperId(){return`${this.modalId}-wrapper`}get modalElement(){return this._modalElemnt&&document.body.contains(this._modalElemnt[0])||(this._modalElemnt=$("#"+this.modalId)),this._modalElemnt}get isAutoShow(){return!0}get destroyOnClose(){return!0}getParentContainerElement(){return document.querySelector("#"+this.wrapperId)}render(){let e=document.querySelectorAll("#"+this.modalId);if(e&&e.length)for(let t=0;t<e.length;t++)e[t].remove();let t=document.createElement("div");t.id=this.wrapperId,t.classList.add("adhara-dialog"),document.querySelector("body").appendChild(t),super.render()}format(){this.isAutoShow&&this.show()}show(){this.modalElement.modal("show"),this.destroyOnClose&&setTimeout(()=>{this.modalElement.on("hidden.bs.modal",this.destroy)},0)}hide(){this.modalElement.modal("hide")}onDestroy(){let e=document.getElementById(this.wrapperId);e&&e.remove()}}class AdharaTabView extends AdharaView{get template(){return"adhara-tab-view"}get containerClass(){return"nav nav-pills"}get tabNavClass(){return"custom-tabs-line tabs-line-bottom left-aligned"}get tabListClass(){return"nav"}get tabs(){return[]}get currentTab(){let e=Adhara.router.getCurrentURL(),t=this.tabs.filter(t=>t.link===e);return t.length?t[0]:this.tabs[0]}get tabsList(){let e=this.currentTab.id;return this.tabs.map(t=>(t.className=t.id===e?"active":"",t))}get nextSelector(){return".btn-next"}get previousSelector(){return".btn-previous"}onTabShow(){}onTabClick(){}onTabChange(){}format(){}get contentContainer(){return".tab-content .tab-pane"}renderSubViews(){Adhara.createView(Adhara.getView(this.currentTab.view,this))}}class AdharaContainerView extends AdharaView{get template(){return"container"}get contentContainer(){return"main"}_getParentContainer(){return Adhara.app.DOMSelector}}class AdharaDialogFormView extends(MutateViews(AdharaFormView,AdharaDialogView)){primaryAction(){this.submit()}get primaryActionTitle(){return"Save"}get submitButton(){return this.getParentContainerElement().querySelector("button.btn-primary")}get buttons(){return this.primaryActionTitle?[super.buttons[0],{attributes:{type:"button",class:"btn btn-primary","data-onclick":"primaryAction"},text:this.primaryActionTitle}]:super.buttons}}class AdharaStorage{select(e,t){throw new Error("return a StorageOperator instance from this method. create a `class xStorageOperator extends AdharaStorageOperator{...}`")}}class AdharaStorageOperator{constructor(e){this.dataset=e}store(e,t){throw new Error("Override `store` method")}retrieve(e){throw new Error("Override `retrieve` method")}remove(e){throw new Error("Override `remove` method")}removeAll(){return this.removeMultiple(()=>!0)}removeMultiple(e){return this.keys().then(async t=>{let r=[];for(let e of t)r.push(await this.retrieve(e));let a=await Promise.all(r),n=[];for(let r=0;r<a.length;r++){let i=a[r],s=t[r];e(s,i)&&n.push(this.remove(s))}return await Promise.all(n)})}keys(){throw new Error("Override `keys` method")}}class StorageSelector{static select(){return window.hasOwnProperty("indexedDB")?AdharaDBStorage:AdharaCacheStorage}}class AdharaDBStorage extends AdharaStorage{constructor(){function e(e){return new Promise(function(t,r){e.onsuccess=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function t(t,r,a){let n,i=new Promise((i,s)=>{e(n=t[r].apply(t,a)).then(i,s)});return i.request=n,i}function r(e,t,r){r.forEach(function(r){Object.defineProperty(e.prototype,r,{get:function(){return this[t][r]},set:function(e){this[t][r]=e}})})}function a(e,r,a,n){n.forEach(n=>{n in a.prototype&&(e.prototype[n]=function(){return t(this[r],n,arguments)})})}function n(e,t,r,a){a.forEach(a=>{a in r.prototype&&(e.prototype[a]=function(){return this[t][a].apply(this[t],arguments)})})}function i(e,r,a,n){n.forEach(function(n){n in a.prototype&&(e.prototype[n]=function(){return function(e,r,a){let n=t(e,r,a);return n.then(function(e){if(e)return new o(e,n.request)})}(this[r],n,arguments)})})}function s(e){this._index=e}function o(e,t){this._cursor=e,this._request=t}function l(e){this._store=e}function u(e){this._tx=e,this.complete=new Promise(function(t,r){e.oncomplete=function(){t()},e.onerror=function(){r(e.error)},e.onabort=function(){r(e.error)}})}function c(e,t,r){this._db=e,this.oldVersion=t,this.transaction=new u(r)}function d(e){this._db=e}super(),r(s,"_index",["name","keyPath","multiEntry","unique"]),a(s,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),i(s,"_index",IDBIndex,["openCursor","openKeyCursor"]),r(o,"_cursor",["direction","key","primaryKey","value"]),a(o,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(t){t in IDBCursor.prototype&&(o.prototype[t]=function(){let r=this,a=arguments;return Promise.resolve().then(function(){return r._cursor[t].apply(r._cursor,a),e(r._request).then(e=>e?new o(e,r._request):null)})})}),l.prototype.createIndex=function(){return new s(this._store.createIndex.apply(this._store,arguments))},l.prototype.index=function(){return new s(this._store.index.apply(this._store,arguments))},r(l,"_store",["name","keyPath","indexNames","autoIncrement"]),a(l,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),i(l,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),n(l,"_store",IDBObjectStore,["deleteIndex"]),u.prototype.objectStore=function(){return new l(this._tx.objectStore.apply(this._tx,arguments))},r(u,"_tx",["objectStoreNames","mode"]),n(u,"_tx",IDBTransaction,["abort"]),c.prototype.createObjectStore=function(){return new l(this._db.createObjectStore.apply(this._db,arguments))},r(c,"_db",["name","version","objectStoreNames"]),n(c,"_db",IDBDatabase,["deleteObjectStore","close"]),d.prototype.transaction=function(){return new u(this._db.transaction.apply(this._db,arguments))},r(d,"_db",["name","version","objectStoreNames"]),n(d,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[l,s].forEach(function(t){t.prototype[e.replace("open","iterate")]=function(){let t=Array.prototype.slice.call(arguments),r=t[t.length-1],a=this._store||this._index,n=a[e].apply(a,t.slice(0,-1));n.onsuccess=function(){r(n.result)}}})}),[s,l].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){let r=this,a=[];return new Promise(function(n){r.iterateCursor(e,function(e){e?(a.push(e.value),void 0===t||a.length!==t?e.continue():n(a)):n(a)})})})});let h=(e,r,a)=>{let n=t(indexedDB,"open",[e,r]),i=n.request;return i.onupgradeneeded=function(e){a&&a(new c(i.result,e.oldVersion,i.transaction))},n.then(e=>new d(e))};this.dbs={};for(let e of Adhara.app.DBConfig)this.dbs[e.id]=h(e.name,e.version,t=>this.createObjectStores(t,e))}createObjectStores(e,t){try{let r=t.schema;for(let t in r)if(r.hasOwnProperty(t)&&!e.objectStoreNames.contains(t)){let a=e.createObjectStore(t,r[t]);for(let e of r[t].indexes)a.createIndex(e.name,e.property,e.options)}return!0}catch(e){return!1}}select(e,t){return new DBStorageOperator(t,this.dbs[e])}}class DBStorageOperator extends AdharaStorageOperator{constructor(e,t){super(e),this.db=t}retrieve(e){return this.db.then(t=>t.transaction(this.dataset).objectStore(this.dataset).get(e))}store(e,t){return t||(t=e,e=void 0),this.db.then(r=>{const a=r.transaction(this.dataset,"readwrite");return a.objectStore(this.dataset).put(t,e),a.complete})}remove(e){return this.db.then(t=>{const r=t.transaction(this.dataset,"readwrite");return r.objectStore(this.dataset).delete(e),r.complete})}removeAll(){return this.db.then(e=>{const t=e.transaction(this.dataset,"readwrite");return t.objectStore(this.dataset).clear(),t.complete})}keys(){return this.db.then(e=>{const t=e.transaction(this.dataset),r=[],a=t.objectStore(this.dataset);return(a.iterateKeyCursor||a.iterateCursor).call(a,e=>{e&&(r.push(e.key),e.continue())}),t.complete.then(()=>r)})}}class AdharaCacheStorage extends Storage{store(e,t){throw new Error("Override `store` method")}retrieve(e){throw new Error("Override `retrieve` method")}remove(e){throw new Error("Override `remove` method")}removeAll(){throw new Error("Override `removeAll` method")}keys(){throw new Error("Override `keys` method")}}class DataInterface extends(StorageSelector.select()){constructor(){super(),this.config=Adhara.app._diConfig,this.request_queue={},this.rem_que={},this.db_table=this.select("default",this.config.http_cache_table),this.initDependencies()}makeServiceCall(e,t,r){return r=Adhara.app.requestMiddleWare(e,t,r),new Promise(function(a,n){RestAPI[t]({url:e,data:r,crossDomain:!0,xhrFields:{withCredentials:!0},beforeSend(e){e.withCredentials=!0},success(e,t){a({response:e,xhr:t})},failure(e,t){n({error:e,xhr:t})}})})}handle_bulk_config(e,t,r,a){if(["get","get_list"].indexOf(e)<0)return;let n=t.length,i=new Array(n),s=0,o=a.caller_view&&(a.caller_view instanceof AdharaView||a.caller_view.hasOwnProperty("handleDataChange")&&"function"==typeof a.caller_view.handleDataChange);for(let l=0;l<n;l++){let u=Object.assign({},t[l]);u.processor=function(e){return{success:function(t,r,l,u){let c=processor_helper.get_basic_processed_data(t,r,l,u);i[e]=c,s++,o?s===n&&a.caller_view.handleDataChange(i):Adhara.configUtils.getViewInstance(r).handleDataChange(c)},error:function(t,r,l,u){let c=processor_helper.get_basic_processed_data(t,r,l,u);i[e]=c,s++,o?s===n&&a.caller_view.handleDataChange(i):Adhara.configUtils.getViewInstance(r).handleDataError(c)}}}(l),this.enqueue(e,u,r,a)}}handle_batch_enqueue(e){let t={},r=Adhara.configUtils.getDataConfig(e).batch_data_override;function a(e){for(let t in e)if(e.hasOwnProperty(t)&&void 0===e[t])return!1;return!0}function n(t){Adhara.configUtils.getViewInstance(e).handleBatchData(t)}let i={success:function(e,r,i,s){let o,l=Adhara.configUtils.getBlobClass(r),u=Adhara.configUtils.getDataConfig(r);if("get_list"===e){o=[];for(let e of i)o.push(new l(e))}else o=new l(i);t[u.identifier]={success:o},a(t)&&n(t),processor_helper.on_success_common(e,r,i,s)},error:function(e,r,i,s){let o=Adhara.configUtils.getDataConfig(r);t[o.identifier]={error:i},a(t)&&n(t)}};for(let a of r){t[a.identifier]=void 0;let r={data_config:{url:a.url,_url:a.url,identifier:a.identifier,default_query_type:a.query_type||"get",allowed_query_types:["get","get_list"],reuse:a.reuse,blob:a.blob},view:Adhara.configUtils.getViewInstance(e),processor:i};this.enqueue(void 0,r,void 0)}}isValidStorageData(e){return e.hasOwnProperty("response")}isMethodAllowed(e,t,r){return-1!==Adhara.app.allowedHttpMethods.indexOf(t)||r.allowed_query_types&&-1!==r.allowed_query_types.indexOf(e)}isValidDataConfig(e){return e instanceof Object&&e.allowed_query_types instanceof Array&&"string"==typeof e.url&&e.allowed_query_types.length>0||e instanceof Object&&e.batch_data_override instanceof Array}isValidProcessor(e){return e instanceof Object&&e.success instanceof Function&&e.error instanceof Function}isValidEntityConfig(e){if(e instanceof Object&&this.isValidDataConfig(e.data_config)){if(e.data_config.batch_data_override)return!0;if(e.data_config.allowed_query_types.indexOf("get")>-1||e.data_config.allowed_query_types.indexOf("get_list")>-1){if(this.isValidProcessor(e.processor))return!0;if(!AdharaView.isPrototypeOf(e.view))return!1}return!0}return!1}getHTTPMethod(e){return"get_list"===e?"get":e}getUniqueUrlForData(e,t,r){return e+(r?"?"+Object.keys(r).sort().map(e=>e+"="+r[e]).join("&"):"")}remember(e,t,r,a){let n={expires:(r.timeout||this.config.reuse_timeout||3e5)+Date.now(),url:a};return"in_page"===r.scope&&(n.page_name=Adhara.router.getCurrentPageName()),this.rem_que[e]=t,this.db_table.store({url:e,response:t,_:n}).then(()=>(delete this.rem_que[e],!0))}recall(e){return new Promise((t,r)=>{this.rem_que[e]?t(this.rem_que[e]):this.db_table.retrieve(e).then(e=>{e?isNaN(e._.expires)||e._.expires<(new Date).getTime()?r({message:"data has expired",code:404}):this.isValidStorageData(e)?t(e.response):r({message:`Invalid data ${e.response}`,code:500}):r({message:"No such key stored",code:404})})})}remove(e){return this.db_table.remove(e)}signalViewSuccess(e,t,r,a){Adhara.configUtils.getProcessor(t).success(e,t,r,a,!0)}signalViewFailure(e,t,r,a){Adhara.configUtils.getProcessor(t).error(e,t,r,a)}enqueue(e,t,r,a){if(!this.isValidEntityConfig(t))throw new Error(`Entity config passed to enqueue is invalid: ${JSON.stringify(t,null,4)}`);let n=Adhara.configUtils.getDataConfig(t);if(n.hasOwnProperty("batch_data_override"))return void this.handle_batch_enqueue(t);if(t instanceof Array)return void this.handle_bulk_config(e,t,r,a);if(this.request_queue[n.url]instanceof Array||(this.request_queue[n.url]=[]),["get","get_list"].indexOf(e)<0&&a&&!1!==a.consider_for_queueing&&(a.consider_for_queueing=!1,this.request_queue[n.url].push({entry_time:performance.now(),arg:[e,t,r,a]}),this.request_queue[n.url].length>1))return;e||(e=n.default_query_type);let i=this.getHTTPMethod(e);if(!this.isMethodAllowed(e,i,n)){let r={message:"Unauthorized Request"};return void this.signalViewFailure(e,t,r,405)}let s=n.reuse||{};if(!1!==s.enable&&!1!==this.config.default_reuse&&-1!==["get","get_list"].indexOf(i)){let a=this.getUniqueUrlForData(n.url,i,r),o=()=>{this.makeServiceCall(n.url,i,r).then(r=>{let i=Adhara.app.responseMiddleWare(t,!0,r.response,r.xhr);this.signalViewSuccess(e,t,i,r.xhr),this.remember(a,i,s,n._url)},r=>{this.signalViewFailure(e,t,Adhara.app.responseMiddleWare(t,!1,r.error,r.xhr),r.xhr)})};this.recall(a).then(r=>{if(s instanceof Function&&!s(r))o();else{let a=new XMLHttpRequest;this.signalViewSuccess(e,t,r,a)}},e=>{o()})}else this.makeServiceCall(n.url,i,r).then(r=>{this.signalViewSuccess(e,t,Adhara.app.responseMiddleWare(t,!0,r.response,r.xhr),r.xhr)},r=>{this.signalViewFailure(e,t,Adhara.app.responseMiddleWare(t,!1,r.error,r.xhr),r.xhr)}).then(()=>{this.request_queue[n.url].shift(),this.request_queue[n.url].length>0&&(performance.now()-this.request_queue[n.url][0].entry_time<=3e4?this.enqueue(...this.request_queue[n.url][0].arg):this.request_queue[n.url]=[])})}cleanUp(e){this.db_table.removeMultiple((t,r)=>r._.expires<=Date.now()||r._.page_name&&r._.page_name!==e)}initDependencies(){Adhara.router.onRoute("DIPageChangeListener",()=>{this.cleanUp(Adhara.router.getCurrentPageName())})}}let processor_helper={on_success_common:function(e,t,r,a,n){let i=Adhara.configUtils.getDataConfig(t);if(!i)return;let s=Adhara.configUtils.getByDataConfig(i);for(let t=0;t<s.length;t++){let i=Adhara.configUtils.getProcessor(s[t]);i&&i.success(e,s[t],r,a,n)}},get_basic_processed_data:function(e,t,r,a){let n,i=Adhara.configUtils.getBlobClass(t);if("get_list"===e){n=[];for(let e of r)n.push(new i(e))}else n=new i(r);return n}},Processor={fallback:{success:function(e,t,r,a,n){let i=processor_helper.get_basic_processed_data(e,t,r,a),s=Adhara.configUtils.getViewInstance(t);!0===n?processor_helper.on_success_common(e,t,r,a,!1):s&&s.handleDataChange(i)},error:function(e,t,r,a){let n={error:r,response_code:a.status},i=Adhara.configUtils.getViewInstance(t);i&&i.handleDataError(n)}}};class WebSocket{constructor(e){let t=this.socket=io.connect(e.url||"/socket",{resource:e.resource||"/"});t.on("connect_failed",e=>console.log("connect_failed",e)),t.on("connecting",e=>console.log("connecting",e)),t.on("disconnect",e=>console.log("disconnect",e)),t.on("error",e=>console.log("error",e)),t.on("reconnect_failed",e=>console.log("reconnect_failed",e)),t.on("reconnect",e=>console.log("reconnect",e)),t.on("reconnecting",e=>console.log("reconnecting",e))}listen(){let e=Adhara.app.config;for(let t in e)if(e.hasOwnProperty(t)){let e=Adhara.configUtils.getDataConfig(t);if(!e.socket_tag)continue;this.socket.on(e.socket_tag,e=>{Adhara.configUtils.getProcessor(t)(e)})}}}WebSocket.listen=(e=>{new WebSocket(e).listen()}),this.Handlebars=this.Handlebars||{},this.Handlebars.templates=this.Handlebars.templates||{},this.Handlebars.templates["adhara-card-content"]=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,r,a,n){var i,s=null!=t?t:e.nullContext||{},o=r.helperMissing,l=e.escapeExpression;return'<div class="card-heading">\r\n    '+l("function"==typeof(i=null!=(i=r.heading||(null!=t?t.heading:t))?i:o)?i.call(s,{name:"heading",hash:{},data:n}):i)+'\r\n</div>\r\n<div class="card-content">\r\n    '+l("function"==typeof(i=null!=(i=r.content||(null!=t?t.content:t))?i:o)?i.call(s,{name:"content",hash:{},data:n}):i)+"\r\n</div>"},useData:!0}),this.Handlebars.templates["adhara-card"]=Handlebars.template({1:function(e,t,r,a,n,i,s){var o=e.escapeExpression;return'        <div class="'+o(e.lambda(null!=s[1]?s[1].cardSizeClass:s[1],t))+'">\r\n            <div class="card-md animated card-content-wrapper">\r\n            '+o((r.include||t&&t.include||r.helperMissing).call(null!=t?t:e.nullContext||{},null!=s[1]?s[1].itemTemplate:s[1],i[0][0],{name:"include",hash:{},data:n,blockParams:i}))+"\r\n            </div>\r\n        </div>\r\n"},compiler:[7,">= 4.0.0"],main:function(e,t,r,a,n,i,s){var o,l,u=null!=t?t:e.nullContext||{};return'<div class="'+e.escapeExpression("function"==typeof(l=null!=(l=r.containerClass||(null!=t?t.containerClass:t))?l:r.helperMissing)?l.call(u,{name:"containerClass",hash:{},data:n,blockParams:i}):l)+' row">\r\n'+(null!=(o=r.each.call(u,null!=t?t.data:t,{name:"each",hash:{},fn:e.program(1,n,2,i,s),inverse:e.noop,data:n,blockParams:i}))?o:"")+"</div>"},useData:!0,useDepths:!0,useBlockParams:!0}),this.Handlebars.templates["adhara-dialog"]=Handlebars.template({1:function(e,t,r,a,n,i){var s,o=e.escapeExpression;return"                    <button "+o((r.addAttr||t&&t.addAttr||r.helperMissing).call(null!=t?t:e.nullContext||{},null!=(s=i[0][0])?s.attributes:s,'{"type": "button"}',{name:"addAttr",hash:{},data:n,blockParams:i}))+">"+o(e.lambda(null!=(s=i[0][0])?s.text:s,t))+"</button>\r\n"},compiler:[7,">= 4.0.0"],main:function(e,t,r,a,n,i){var s,o,l=null!=t?t:e.nullContext||{},u=r.helperMissing,c=e.escapeExpression;return'<div class="modal fade" id="'+c("function"==typeof(o=null!=(o=r.modalId||(null!=t?t.modalId:t))?o:u)?o.call(l,{name:"modalId",hash:{},data:n,blockParams:i}):o)+'" tabindex="-1" role="dialog">\r\n    <div class="modal-dialog" role="document">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <h5 class="modal-title">'+c((r.include||t&&t.include||u).call(l,null!=t?t.titleTemplate:t,t,{name:"include",hash:{},data:n,blockParams:i}))+'</h5>\r\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\r\n                    <span aria-hidden="true">&times;</span>\r\n                </button>\r\n            </div>\r\n            <div class="modal-body">\r\n                <div class="row">\r\n                    <div class="col-md-12">\r\n                        <div class="modal-msg">'+c((r.include||t&&t.include||u).call(l,null!=t?t.messageTemplate:t,t,{name:"include",hash:{},data:n,blockParams:i}))+'</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="modal-footer">\r\n'+(null!=(s=r.each.call(l,null!=t?t.buttons:t,{name:"each",hash:{},fn:e.program(1,n,2,i),inverse:e.noop,data:n,blockParams:i}))?s:"")+"            </div>\r\n        </div>\r\n    </div>\r\n</div>"},useData:!0,useBlockParams:!0}),this.Handlebars.templates["adhara-list-grid"]=Handlebars.template({1:function(e,t,r,a,n,i){var s;return"            <th "+(null!=(s=r.if.call(null!=t?t:e.nullContext||{},null!=(s=i[0][0])?s.width:s,{name:"if",hash:{},fn:e.program(2,n,0,i),inverse:e.noop,data:n,blockParams:i}))?s:"")+">"+e.escapeExpression(e.lambda(null!=(s=i[0][0])?s.display_name:s,t))+"</th>\r\n"},2:function(e,t,r,a,n,i){var s;return'width="'+e.escapeExpression(e.lambda(null!=(s=i[1][0])?s.width:s,t))+'"'},4:function(e,t,r,a,n,i,s){var o;return'        <tr adhara-datum-row="'+e.escapeExpression(e.lambda(i[0][1],t))+'">\r\n'+(null!=(o=r.each.call(null!=t?t:e.nullContext||{},null!=s[1]?s[1].columns:s[1],{name:"each",hash:{},fn:e.program(5,n,2,i,s),inverse:e.noop,data:n,blockParams:i}))?o:"")+"        </tr>\r\n"},5:function(e,t,r,a,n,i){var s,o=e.lambda,l=e.escapeExpression;return'                <td adhara-datum-col="'+l(o(i[1][1],t))+"-"+l(o(null!=(s=i[0][0])?s.name:s,t))+'" align="'+l(o(null!=(s=i[0][0])?s.align:s,t))+'">\r\n'+(null!=(s=r.if.call(null!=t?t:e.nullContext||{},null!=(s=i[0][0])?s.trust_as_html:s,{name:"if",hash:{},fn:e.program(6,n,0,i),inverse:e.program(8,n,0,i),data:n,blockParams:i}))?s:"")+"                </td>\r\n"},6:function(e,t,r,a,n,i){var s;return"                        "+(null!=(s=(r.get||t&&t.get||r.helperMissing).call(null!=t?t:e.nullContext||{},i[2][0],null!=(s=i[1][0])?s.name:s,{name:"get",hash:{},data:n,blockParams:i}))?s:"")+"\r\n"},8:function(e,t,r,a,n,i){var s;return"                        "+e.escapeExpression((r.get||t&&t.get||r.helperMissing).call(null!=t?t:e.nullContext||{},i[2][0],null!=(s=i[1][0])?s.name:s,{name:"get",hash:{},data:n,blockParams:i}))+"\r\n"},compiler:[7,">= 4.0.0"],main:function(e,t,r,a,n,i,s){var o,l,u=null!=t?t:e.nullContext||{};return'<table class="table '+e.escapeExpression("function"==typeof(l=null!=(l=r.tableClass||(null!=t?t.tableClass:t))?l:r.helperMissing)?l.call(u,{name:"tableClass",hash:{},data:n,blockParams:i}):l)+'">\r\n    <thead>\r\n    <tr>\r\n'+(null!=(o=r.each.call(u,null!=t?t.columns:t,{name:"each",hash:{},fn:e.program(1,n,2,i,s),inverse:e.noop,data:n,blockParams:i}))?o:"")+"    </tr>\r\n    </thead>\r\n    <tbody>\r\n"+(null!=(o=r.each.call(u,null!=t?t.data:t,{name:"each",hash:{},fn:e.program(4,n,2,i,s),inverse:e.noop,data:n,blockParams:i}))?o:"")+"    </tbody>\r\n</table>"},useData:!0,useDepths:!0,useBlockParams:!0}),this.Handlebars.templates["adhara-list-template-header"]=Handlebars.template({1:function(e,t,r,a,n,i){var s;return"    <b>"+e.escapeExpression(e.lambda(null!=(s=i[0][0])?s.display_name:s,t))+"</b>&nbsp;|\r\n"},compiler:[7,">= 4.0.0"],main:function(e,t,r,a,n,i){var s;return null!=(s=r.each.call(null!=t?t:e.nullContext||{},t,{name:"each",hash:{},fn:e.program(1,n,2,i),inverse:e.noop,data:n,blockParams:i}))?s:""},useData:!0,useBlockParams:!0}),this.Handlebars.templates["adhara-list-template-item"]=Handlebars.template({1:function(e,t,r,a,n){var i,s=null!=t?t:e.nullContext||{},o=r.helperMissing,l=e.escapeExpression;return"        <b>"+l("function"==typeof(i=null!=(i=r.key||(null!=t?t.key:t))?i:o)?i.call(s,{name:"key",hash:{},data:n}):i)+"</b>: "+l("function"==typeof(i=null!=(i=r.value||(null!=t?t.value:t))?i:o)?i.call(s,{name:"value",hash:{},data:n}):i)+"<br />\r\n"},compiler:[7,">= 4.0.0"],main:function(e,t,r,a,n){var i;return"<div>\r\n"+(null!=(i=(r.loopObject||t&&t.loopObject||r.helperMissing).call(null!=t?t:e.nullContext||{},t,{name:"loopObject",hash:{},fn:e.program(1,n,0),inverse:e.noop,data:n}))?i:"")+"</div>\r\n"},useData:!0}),this.Handlebars.templates["adhara-list-template"]=Handlebars.template({1:function(e,t,r,a,n,i,s){var o,l=e.lambda,u=e.escapeExpression,c=null!=t?t:e.nullContext||{},d=r.helperMissing;return'            <tr adhara-datum-row="'+u(l(i[0][1],t))+'">\r\n                <td adhara-datum-col="'+u(l(i[0][1],t))+"-"+u("function"==typeof(o=null!=(o=r.column||(null!=t?t.column:t))?o:d)?o.call(c,{name:"column",hash:{},data:n,blockParams:i}):o)+'">\r\n                    '+u((r.include||t&&t.include||d).call(c,null!=s[1]?s[1].itemTemplate:s[1],i[0][0],{name:"include",hash:{},data:n,blockParams:i}))+"\r\n                </td>\r\n            </tr>\r\n"},compiler:[7,">= 4.0.0"],main:function(e,t,r,a,n,i,s){var o,l,u=null!=t?t:e.nullContext||{},c=r.helperMissing,d=e.escapeExpression;return"<div "+d((r.addAttr||t&&t.addAttr||c).call(u,null!=t?t.containerAttributes:t,{name:"addAttr",hash:{},data:n,blockParams:i}))+'>\r\n    <table class="table '+d("function"==typeof(l=null!=(l=r.tableClass||(null!=t?t.tableClass:t))?l:c)?l.call(u,{name:"tableClass",hash:{},data:n,blockParams:i}):l)+'">\r\n        <thead>\r\n        <tr>\r\n            '+d((r.include||t&&t.include||c).call(u,null!=t?t.headerTemplate:t,null!=t?t.columns:t,{name:"include",hash:{},data:n,blockParams:i}))+"\r\n        </tr>\r\n        </thead>\r\n        <tbody>\r\n"+(null!=(o=r.each.call(u,null!=t?t.data:t,{name:"each",hash:{},fn:e.program(1,n,2,i,s),inverse:e.noop,data:n,blockParams:i}))?o:"")+"        </tbody>\r\n    </table>\r\n</div>"},useData:!0,useDepths:!0,useBlockParams:!0}),this.Handlebars.templates["adhara-list"]=Handlebars.template({1:function(e,t,r,a,n){var i;return"        <div>\r\n            <h3>"+e.escapeExpression("function"==typeof(i=null!=(i=r.title||(null!=t?t.title:t))?i:r.helperMissing)?i.call(null!=t?t:e.nullContext||{},{name:"title",hash:{},data:n}):i)+"</h3>\r\n        </div>\r\n"},3:function(e,t,r,a,n){var i;return'        <div>\r\n            <button class="btn btn-sm btn-primary">Add new '+e.escapeExpression("function"==typeof(i=null!=(i=r.title||(null!=t?t.title:t))?i:r.helperMissing)?i.call(null!=t?t:e.nullContext||{},{name:"title",hash:{},data:n}):i)+"</button>\r\n        </div>\r\n"},5:function(e,t,r,a,n){return'        <div class="adhara-list-wrapper">\r\n            '+e.escapeExpression((r.include||t&&t.include||r.helperMissing).call(null!=t?t:e.nullContext||{},null!=t?t.fetchingDataTemplate:t,t,{name:"include",hash:{},data:n}))+"\r\n        </div>\r\n"},7:function(e,t,r,a,n){var i;return null!=(i=r.if.call(null!=t?t:e.nullContext||{},null!=t?t.data:t,{name:"if",hash:{},fn:e.program(8,n,0),inverse:e.program(12,n,0),data:n}))?i:""},8:function(e,t,r,a,n){var i,s=null!=t?t:e.nullContext||{};return'            <div class="adhara-list-wrapper row">\r\n                '+e.escapeExpression((r.include||t&&t.include||r.helperMissing).call(s,null!=t?t.listTemplate:t,t,{name:"include",hash:{},data:n}))+"\r\n            </div>\r\n"+(null!=(i=r.if.call(s,null!=t?t.isPaginationRequired:t,{name:"if",hash:{},fn:e.program(9,n,0),inverse:e.noop,data:n}))?i:"")},9:function(e,t,r,a,n){var i,s=null!=t?t:e.nullContext||{},o=r.helperMissing,l=e.escapeExpression;return'                <div class="row flex-row-reverse">\r\n                    <div class="btn-group" role="group">\r\n                        <button '+(null!=(i=r.if.call(s,null!=t?t.isFirstPage:t,{name:"if",hash:{},fn:e.program(10,n,0),inverse:e.noop,data:n}))?i:"")+' class="btn btn-sm btn-link d-inline-block" data-onclick="onPreviousPage">'+l((r.i18n||t&&t.i18n||o).call(s,'"i18n.adhara.list.previous"',{name:"i18n",hash:{},data:n}))+"</button>\r\n                        <button "+(null!=(i=r.if.call(s,null!=t?t.isLastPage:t,{name:"if",hash:{},fn:e.program(10,n,0),inverse:e.noop,data:n}))?i:"")+' class="btn btn-sm btn-link d-inline-block ml-2" data-onclick="onNextPage">'+l((r.i18n||t&&t.i18n||o).call(s,'"i18n.adhara.list.next"',{name:"i18n",hash:{},data:n}))+"</button>\r\n                    </div>\r\n                </div>\r\n"},10:function(e,t,r,a,n){return"disabled"},12:function(e,t,r,a,n){return'            <div class="adhara-list-wrapper">\r\n                '+e.escapeExpression((r.include||t&&t.include||r.helperMissing).call(null!=t?t:e.nullContext||{},null!=t?t.noDataTemplate:t,t,{name:"include",hash:{},data:n}))+"\r\n            </div>\r\n"},compiler:[7,">= 4.0.0"],main:function(e,t,r,a,n){var i,s,o=null!=t?t:e.nullContext||{},l=r.helperMissing,u=e.escapeExpression;return'<div id="adharaTable_'+u("function"==typeof(s=null!=(s=r.title||(null!=t?t.title:t))?s:l)?s.call(o,{name:"title",hash:{},data:n}):s)+'" class="adhara-table-container" '+u((r.addAttr||t&&t.addAttr||l).call(o,null!=t?t.containerAttributes:t,'{"class":"adhara-table-container"}',{name:"addAttr",hash:{},data:n}))+">\r\n"+(null!=(i=r.if.call(o,null!=t?t.title:t,{name:"if",hash:{},fn:e.program(1,n,0),inverse:e.noop,data:n}))?i:"")+(null!=(i=r.if.call(o,null!=t?t.addNew:t,{name:"if",hash:{},fn:e.program(3,n,0),inverse:e.noop,data:n}))?i:"")+(null!=(i=r.if.call(o,null!=(i=null!=t?t.state:t)?i.fetching_data:i,{name:"if",hash:{},fn:e.program(5,n,0),inverse:e.program(7,n,0),data:n}))?i:"")+"</div>"},useData:!0}),this.Handlebars.templates["adhara-tab-view"]=Handlebars.template({1:function(e,t,r,a,n){var i,s=null!=t?t:e.nullContext||{},o=r.helperMissing,l=e.escapeExpression;return'                <li class="'+l("function"==typeof(i=null!=(i=r.className||(null!=t?t.className:t))?i:o)?i.call(s,{name:"className",hash:{},data:n}):i)+'">\r\n                    <a href="'+l("function"==typeof(i=null!=(i=r.link||(null!=t?t.link:t))?i:o)?i.call(s,{name:"link",hash:{},data:n}):i)+'">\r\n                        \x3c!--<div class="icon-circle">\r\n                            <i class="tab-icon ti-x '+l("function"==typeof(i=null!=(i=r.icon||(null!=t?t.icon:t))?i:o)?i.call(s,{name:"icon",hash:{},data:n}):i)+'"></i>\r\n                        </div>--\x3e\r\n                        '+l("function"==typeof(i=null!=(i=r.name||(null!=t?t.name:t))?i:o)?i.call(s,{name:"name",hash:{},data:n}):i)+"\r\n                    </a>\r\n                </li>\r\n"},compiler:[7,">= 4.0.0"],main:function(e,t,r,a,n){var i,s,o=null!=t?t:e.nullContext||{},l=r.helperMissing,u=e.escapeExpression;return'<div class="'+u("function"==typeof(s=null!=(s=r.containerClass||(null!=t?t.containerClass:t))?s:l)?s.call(o,{name:"containerClass",hash:{},data:n}):s)+'">\r\n    <div class="'+u("function"==typeof(s=null!=(s=r.tabNavClass||(null!=t?t.tabNavClass:t))?s:l)?s.call(o,{name:"tabNavClass",hash:{},data:n}):s)+'">\r\n        <ul class="'+u("function"==typeof(s=null!=(s=r.tabListClass||(null!=t?t.tabListClass:t))?s:l)?s.call(o,{name:"tabListClass",hash:{},data:n}):s)+'">\r\n'+(null!=(i=r.each.call(o,null!=t?t.tabsList:t,{name:"each",hash:{},fn:e.program(1,n,0),inverse:e.noop,data:n}))?i:"")+'        </ul>\r\n        <div class="tab-content">\r\n            <div class="tab-pane active in">\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'},useData:!0});